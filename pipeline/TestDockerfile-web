FROM tcr.ap.toyota-asia.com/hubdocker/library/nginx:1.26

# เปลี่ยน listen port จาก 80 เป็น 8080
RUN sed -i 's/listen\s\+80;/listen 8080;/' /etc/nginx/conf.d/default.conf

# แก้สิทธิ์โฟลเดอร์ที่ Nginx ต้องเขียน
RUN mkdir -p /var/cache/nginx /var/run /etc/nginx/conf.d \
    && chgrp -R 0 /var/cache/nginx /var/run /etc/nginx/conf.d \
    && chmod -R g+rwX /var/cache/nginx /var/run /etc/nginx/conf.d

# รันด้วย non-root UID ตาม OpenShift SCC
USER 1001
